prior = {'H': 0.41, 'L': 0.59}
conditional = {
    ('Encouraging', 'H'): 0.8,
    ('Discouraging', 'H'): 0.2,
    ('Encouraging', 'L'): 0.3,
    ('Discouraging', 'L'): 0.7
}

joint = {
    (0, 0): 0.7 * 0.59,  # P(X=0, θ=0)
    (0, 1): 0.2 * 0.41,  # P(X=0, θ=1)
    (1, 0): 0.3 * 0.59,  # P(X=1, θ=0)
    (1, 1): 0.8 * 0.41   # P(X=1, θ=1)
}

print(f"\nP(X=0, θ=0) = {joint[(0, 0)]:.4f}")
print(f"P(X=0, θ=1) = {joint[(0, 1)]:.4f}")
print(f"P(X=1, θ=0) = {joint[(1, 0)]:.4f}")
print(f"P(X=1, θ=1) = {joint[(1, 1)]:.4f}")


print("計算 P(X=1) - 樂觀報告的機率")

p_x1 = joint[(1, 0)] + joint[(1, 1)]

print(f"\nP(X=1) = P(樂觀報告)")
print(f"       = P(X=1, θ=0) + P(X=1, θ=1)")
print(f"       = {joint[(1, 0)]:.4f} + {joint[(1, 1)]:.4f}")
print(f"       = {p_x1:.4f}")

print(f"\n解釋:")
print(f"  市場調查顯示「樂觀」的機率為 {p_x1:.2%}")
print(f"  這包含兩種情況:")
print(f"    1. 實際低需求但調查樂觀 (機率 {joint[(1, 0)]:.4f})")
print(f"    2. 實際高需求且調查樂觀 (機率 {joint[(1, 1)]:.4f})")

# 也可以用全機率公式驗證
print(f"\n驗證（全機率公式）:")
print(f"  P(X=1) = P(X=1|θ=0)×P(θ=0) + P(X=1|θ=1)×P(θ=1)")
print(f"         = {conditional[('Encouraging', 'L')]}×{prior['L']} + "
      f"{conditional[('Encouraging', 'H')]}×{prior['H']}")
print(f"         = {conditional[('Encouraging', 'L')] * prior['L']:.4f} + "
      f"{conditional[('Encouraging', 'H')] * prior['H']:.4f}")
print(f"         = {p_x1:.4f}  ")

print("計算 P(X=0) - 悲觀報告的機率")
p_x0 = joint[(0, 0)] + joint[(0, 1)]

print(f"\nP(X=0) = P(悲觀報告)")
print(f"       = P(X=0, θ=0) + P(X=0, θ=1)")
print(f"       = {joint[(0, 0)]:.4f} + {joint[(0, 1)]:.4f}")
print(f"       = {p_x0:.4f}")

print(f"\n解釋:")
print(f"  市場調查顯示「悲觀」的機率為 {p_x0:.2%}")
print(f"  這包含兩種情況:")
print(f"    1. 實際低需求且調查悲觀 (機率 {joint[(0, 0)]:.4f})")
print(f"    2. 實際高需求但調查悲觀 (機率 {joint[(0, 1)]:.4f})")

# 全機率公式驗證
print(f"\n驗證（全機率公式）:")
print(f"  P(X=0) = P(X=0|θ=0)×P(θ=0) + P(X=0|θ=1)×P(θ=1)")
print(f"         = {conditional[('Discouraging', 'L')]}×{prior['L']} + "
      f"{conditional[('Discouraging', 'H')]}×{prior['H']}")
print(f"         = {conditional[('Discouraging', 'L')] * prior['L']:.4f} + "
      f"{conditional[('Discouraging', 'H')] * prior['H']:.4f}")
print(f"         = {p_x0:.4f}  ")

print("邊際機率表（完整）")

print(f"""
┌─────────────────┬──────────────┬──────────────┬─────────────┐
│  真實需求 \\ 調查 │  X=0 (悲觀)  │  X=1 (樂觀)  │  邊際 P(θ)  │
├─────────────────┼──────────────┼──────────────┼─────────────┤
│ θ=0 (低需求)    │   {joint[(0,0)]:.4f}     │   {joint[(1,0)]:.4f}     │   {prior['L']:.2f}      │
│ θ=1 (高需求)    │   {joint[(0,1)]:.4f}     │   {joint[(1,1)]:.4f}     │   {prior['H']:.2f}      │
├─────────────────┼──────────────┼──────────────┼─────────────┤
│ 邊際 P(X)       │   {p_x0:.4f}     │   {p_x1:.4f}     │   1.0000    │
└─────────────────┴──────────────┴──────────────┴─────────────┘

說明：
  • 最下方一列（邊際 P(X)）就是我們計算的結果
  • P(X=0) = 列總和 = {p_x0:.4f}
  • P(X=1) = 列總和 = {p_x1:.4f}
  • 右側一欄是先驗機率 P(θ)
""")


total = p_x0 + p_x1
print(f"\n邊際機率總和:")
print(f"  P(X=0) + P(X=1) = {p_x0:.4f} + {p_x1:.4f} = {total:.4f}")

if abs(total - 1.0) < 0.0001:
    print(f"  ✓ 驗證通過！總和 = 1")
else:
    print(f"  ✗ 驗證失敗！總和應該 = 1")


print(f"""
P(X=1) = {p_x1:.4f} ({p_x1:.2%})
  → 如果進行市場調查，有 {p_x1:.2%} 的機會得到「樂觀」報告
  
P(X=0) = {p_x0:.4f} ({p_x0:.2%})
  → 如果進行市場調查，有 {p_x0:.2%} 的機會得到「悲觀」報告

""")


print(f"""
P(X=1) = {p_x1:.4f} 的組成：
  ┌─────────────────────────────────────────┐
  │ 樂觀且低需求: {joint[(1,0)]:.4f} ({joint[(1,0)]/p_x1*100:.1f}%) │
  ├─────────────────────────────────────────┤
  │ 樂觀且高需求: {joint[(1,1)]:.4f} ({joint[(1,1)]/p_x1*100:.1f}%) │
  └─────────────────────────────────────────┘

P(X=0) = {p_x0:.4f} 的組成：
  ┌─────────────────────────────────────────┐
  │ 悲觀且低需求: {joint[(0,0)]:.4f} ({joint[(0,0)]/p_x0*100:.1f}%) │
  ├─────────────────────────────────────────┤
  │ 悲觀且高需求: {joint[(0,1)]:.4f} ({joint[(0,1)]/p_x0*100:.1f}%) │
  └─────────────────────────────────────────┘
""")

print("總結")
print(f"""
兩個邊際機率計算完成：

P(X=1) = {p_x1:.4f}  (樂觀報告的機率)
P(X=0) = {p_x0:.4f}  (悲觀報告的機率)

""")

# 儲存結果
marginal_prob = {
    'P(X=0)': p_x0,
    'P(X=1)': p_x1
}
